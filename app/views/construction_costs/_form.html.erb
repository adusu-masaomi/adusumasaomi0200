<%= simple_form_for @construction_cost, :html => { :class => 'well form-horizontal' } do |f| %>
  <!--<%= f.input :construction_datum_id %>-->
  <%= f.label :工事コード, {:class => "my-custom-class-l"}  %></br>
  <%= f.collection_select :construction_datum_id, ConstructionDatum.all, :id, :construction_code, {:prompt => "どれか一つを選択して下さい",:selected => @construction_cost.construction_datum_id} , {id:"construction_datum_id", class: "searchableConstructionCode" , style: 'width:220px'} %>
  <%= f.fields_for :construction_datum, :remote => true do |p| %>
  	<%= p.input :construction_name , input_html:{id:"construction_name", :disabled => true} %>
  <% end %>
  <%= f.input :supplies_expense %>
  <%= f.input :labor_cost, input_html:{id:"labor_cost"} %>
  <%= f.input :misellaneous_expense %>
  <%= f.input :constructing_amount , input_html:{}%>
  <!--<%= f.input :purchase_order_amount, input_html:{id:"purchase_order_amount"} , as: :hidden %>-->
  <%= f.input :purchase_order_amount, hint: "＊自動計算されるので入力しないで下さい。但し更新したい場合は、ここに一旦カーソルを当ててから解除下さい。", input_html:{id:"purchase_order_amount",:onfocusout => "setPurchaseOrder()"} %>
  
  <!--<%= f.button :submit, :class => 'btn-primary' %>-->
  <%= f.button_tag :登録する, :type => 'button', :class => "btn btn-primary", 
               :onclick => "submitAfterValidation()" %>
			   
  <%= link_to t('.cancel', :default => t("helpers.links.cancel")),
                construction_costs_path, :class => 'btn btn-default' %>
<% end %>

<script type="text/javascript">

   datasetflag = 0;

　　$(document).ready(function(){
		//検索可能なリストボックス(注文Noの場合)
	　$(".searchableConstructionCode").select2({ theme: "bootstrap" });

	  $( ".searchableConstructionCode" ).change(function(e) {
	  　  setConstructionDateDefault();
          setLaborCost();
		  setPurchaseOrderAmount();
		  datasetflag = 1;
	  });
	});

  function setPurchaseOrder()
  {
       if (datasetflag == 0) {
  	       setLaborCost();
		   setPurchaseOrderAmount();
       }
		 
   
  }

  //工事名のセット
  function setConstructionDateDefault()
    {  
      obj = document.getElementById("construction_datum_id");
       construction_id = parseInt(obj.value);
       $.get("<%= construction_costz_construction_name_select_path %>",
         {id: construction_id },
          function(data){
	           obj = document.getElementById("construction_name").textContent;
	           document.getElementById("construction_name").value = obj;
			   //obj = document.getElementById("construction_name");
		       //debugger;
          }
        );
	 };
	 
   //労務費のセット
  function setLaborCost()
    {  
      obj = document.getElementById("construction_datum_id");
       construction_datum_id = parseInt(obj.value);
       $.get("<%= construction_costz_construction_labor_cost_select_path %>",
         {construction_datum_id: construction_datum_id },
          function(data){
	           obj = document.getElementById("labor_cost").textContent;
	           document.getElementById("labor_cost").value = obj;
			   
			   //obj = document.getElementById("labor_cost");
		       //debugger;
          }
        );
	 };
	 
   //注文No,合計セット
   function setPurchaseOrderAmount()
    {  
       obj = document.getElementById("construction_datum_id");
       construction_datum_id = parseInt(obj.value);
       $.get("<%= construction_costz_purchase_order_amount_select_path %>",
         {construction_datum_id: construction_datum_id },
          function(data){
	           obj = document.getElementById("purchase_order_amount").textContent;
	           document.getElementById("purchase_order_amount").value = obj;

               //obj = document.getElementById("purchase_order_amount");
		       //debugger;
          }
        );
	 };

    //入力チェック後の、更新処理
   function submitAfterValidation() {

	   //if (window.confirm('更新しますか？')) {
	  	 //if (datasetflag == 0) {
  	     //  setLaborCost();
		 //  setPurchaseOrderAmount();
        // }
		 
		 document.forms[0].submit();
       //}
 }

</script>